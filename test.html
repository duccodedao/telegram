<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kết nối TON Wallet với TonConnectUI</title>

    <!-- Thêm thư viện TonConnectUI từ CDN -->
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
</head>
<body>
    <h1>Unich - Kết nối và giao dịch ví TON</h1>

    <!-- Nút kết nối ví TON -->
    <button id="connectButton">Kết nối ví TON</button>

    <!-- Hiển thị số dư -->
    <p id="balanceResult">Số dư: Chưa có</p>

    <!-- Nút thực hiện giao dịch -->
    <button id="sendTransactionButton">Gửi giao dịch</button>

    <!-- Kết quả giao dịch -->
    <p id="transactionResult">Trạng thái giao dịch: Chưa có</p>

    <script>
        // Khởi tạo TonConnectUI từ thư viện đã tải qua CDN
        const tonConnectUI = new TonConnectUI.TonConnectUI({
            manifestUrl: 'https://bmasshd.click/tonconnect-manifest.json',
            buttonRootId: 'connectButton' // ID của nút kết nối
        });

        // Hàm kết nối ví TON và lấy số dư
        async function connectWallet() {
            try {
                const walletInfo = await tonConnectUI.connect();
                if (walletInfo) {
                    console.log("Đã kết nối ví:", walletInfo);
                    const balance = await tonConnectUI.getBalance(walletInfo.account.address);
                    document.getElementById("balanceResult").innerText = `Số dư: ${balance / 1e9} TON`; // chuyển từ nanoTON
                }
            } catch (error) {
                console.error("Lỗi khi kết nối ví:", error);
            }
        }

        // Hàm thực hiện giao dịch
        async function sendTransaction() {
            const transaction = {
                messages: [
                    {
                        address: "EQABa48hjKzg09hN_HjxOic7r8T1PleIy1dRd8NvZ3922MP0", // Địa chỉ ví nhận
                        amount: "20000000" // Toncoin trong đơn vị nanoTON
                    }
                ]
            };

            try {
                const result = await tonConnectUI.sendTransaction(transaction);
                console.log("Giao dịch thành công:", result);
                document.getElementById("transactionResult").innerText = "Giao dịch thành công!";
            } catch (error) {
                console.error("Lỗi khi gửi giao dịch:", error);
                document.getElementById("transactionResult").innerText = "Giao dịch thất bại!";
            }
        }

        // Khi đã tải xong trang
        window.addEventListener('DOMContentLoaded', () => {
            // Gán sự kiện cho nút kết nối và gửi giao dịch
            document.getElementById("connectButton").onclick = connectWallet;
            document.getElementById("sendTransactionButton").onclick = sendTransaction;
        });
    </script>
</body>
</html>
